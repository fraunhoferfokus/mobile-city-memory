function errorLocationCallback(o){userLocation.moveToLocation(this.DEFAULT_LAT,this.DEFAULT_LONG),alert("There was an error obtaining your position. Message: "+o.message)}function addMarker(o){var e=parseFloat(o.latitude._int)*Math.pow(10,o.latitude._exp),t=parseFloat(o.longitude._int)*Math.pow(10,o.longitude._exp);if(!userLocation.markers.hasOwnProperty(o.id)){var n=new google.maps.Marker({map:userLocation.map,position:new google.maps.LatLng(e,t),title:o.label,icon:"/static/stadtgedaechtnis/img/marker_story.png",animation:google.maps.Animation.DROP});o.marker=n,createInfobox(o),userLocation.markers[o.id]=o}}function createInfobox(o){if(o.entries.length>1);else var e="<p class='infowindow'>"+o.entries[0].abstract+"</p>";var t=new google.maps.InfoWindow({content:e,maxWidth:225});o.infobox=t,google.maps.event.addListener(o.marker,"click",function(){openEntry(o)}),google.maps.event.addListener(t,"closeclick",closeEntry)}function openEntry(o){var e=$("footer[role='complementary']");e.css("padding","0.5rem"),e.transition({height:footerHeight},100,"ease"),$("#container").transition({paddingBottom:footerHeight,marginBottom:"-"+footerHeight},200,"ease"),userLocation.currentInfobox=o.infobox,o.infobox.open(userLocation.map,o.marker)}function closeEntry(){var o=$("footer[role='complementary']");o.transition({height:footerHeight},100,"ease"),$("#container").transition({paddingBottom:"0px",marginBottom:"0px"},200,"ease",function(){o.css("padding","0rem")}),null!=userLocation.currentInfobox&&userLocation.currentInfobox.close()}function searchForEntries(){var o=userLocation.map.getBounds(),e=o.getNorthEast().lat().toFixed(10),t=o.getNorthEast().lng().toFixed(10),n=o.getSouthWest().lat().toFixed(10),a=o.getSouthWest().lng().toFixed(10);$.getJSON("../stadtgedaechtnis/services/get-nearby-locations/"+n+"/"+e+"/"+a+"/"+t+"/",function(o){$.each(o,function(o,e){addMarker(e)})})}function Location(){this.DEFAULT_LAT=50.258,this.DEFAULT_LONG=10.965,this.DEFAULT_LOCATION=new google.maps.LatLng(50.258,10.965),this.positionMarker=null,this.markers={},this.currentInfobox=null}function initialize_Map(){userLocation.map=new google.maps.Map(document.getElementById(MAP_ELEMENT),mapOptions),userLocation.positionMarker=new GeolocationMarker(userLocation.map),userLocation.moveToCurrentLocationOrFallback(),google.maps.event.addListener(userLocation.positionMarker,"geolocation_error",errorLocationCallback),google.maps.event.addListener(userLocation.map,"idle",searchForEntries),google.maps.event.addListener(userLocation.map,"click",closeEntry)}var MAP_ELEMENT="map_canvas";Location.prototype.moveToCurrentLocationOrFallback=function(){Modernizr.geolocation?google.maps.event.addListenerOnce(this.positionMarker,"position_changed",function(){this.map.setCenter(this.getPosition()),this.map.fitBounds(this.getBounds()),searchForEntries()}):this.moveToLocation(this.DEFAULT_LAT,this.DEFAULT_LONG)},Location.prototype.moveToLocation=function(o){this.map&&(this.map.panTo(o),searchForEntries())};var userLocation=new Location,mapOptions={center:userLocation.DEFAULT_LOCATION,zoom:17,mapTypeControl:!0,mapTypeId:google.maps.MapTypeId.SATELLITE,disableDefaultUI:!0,zoomControl:!0};