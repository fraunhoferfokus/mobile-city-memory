function errorLocationCallback(o){userLocation.moveToLocation(this.DEFAULT_LAT,this.DEFAULT_LONG),alert("There was an error obtaining your position. Message: "+o.message)}function addMarker(o){var t=parseFloat(o.latitude._int)*Math.pow(10,o.latitude._exp),e=parseFloat(o.longitude._int)*Math.pow(10,o.longitude._exp);if(!userLocation.markers.hasOwnProperty(o.id)){var n=new google.maps.Marker({map:userLocation.map,position:new google.maps.LatLng(t,e),title:o.label,icon:"/static/stadtgedaechtnis/img/marker_story.png",animation:google.maps.Animation.DROP});o.marker=n,createInfobox(o),userLocation.markers[o.id]=o}}function createInfobox(o){if(o.entries.length>1);else var t="<p class='infowindow'>"+o.entries[0].abstract+"</p>";var e=new google.maps.InfoWindow({content:t,maxWidth:225});o.infobox=e,google.maps.event.addListener(o.marker,"click",function(){openEntry(o)}),google.maps.event.addListener(e,"closeclick",closeEntry)}function openEntry(o){$("#container").animate({paddingBottom:footerHeight,marginBottom:"-"+footerHeight},{start:function(){$("footer[role='complementary']").animate({height:"8rem"},{duration:100,easing:"swing"})},duration:100,easing:"swing"}),userLocation.currentInfobox=o.infobox,o.infobox.open(userLocation.map,o.marker)}function closeEntry(){$("#container").animate({paddingBottom:"0px",marginBottom:"0px"},{start:function(){$("footer[role='complementary']").animate({height:"0rem"},{duration:100,easing:"swing"})},duration:100,easing:"swing"}),null!=userLocation.currentInfobox&&userLocation.currentInfobox.close()}function searchForEntries(){var o=userLocation.map.getBounds(),t=o.getNorthEast().lat().toFixed(10),e=o.getNorthEast().lng().toFixed(10),n=o.getSouthWest().lat().toFixed(10),a=o.getSouthWest().lng().toFixed(10);$.getJSON("../stadtgedaechtnis/services/get-nearby-locations/"+n+"/"+t+"/"+a+"/"+e+"/",function(o){$.each(o,function(o,t){addMarker(t)})})}function Location(){this.DEFAULT_LAT=50.258,this.DEFAULT_LONG=10.965,this.DEFAULT_LOCATION=new google.maps.LatLng(50.258,10.965),this.positionMarker=null,this.markers={},this.currentInfobox=null}function initialize_Map(){userLocation.map=new google.maps.Map(document.getElementById(MAP_ELEMENT),mapOptions),userLocation.positionMarker=new GeolocationMarker(userLocation.map),userLocation.moveToCurrentLocationOrFallback(),google.maps.event.addListener(userLocation.positionMarker,"geolocation_error",errorLocationCallback),google.maps.event.addListener(userLocation.map,"idle",searchForEntries),google.maps.event.addListener(userLocation.map,"click",closeEntry)}var MAP_ELEMENT="map_canvas";Location.prototype.moveToCurrentLocationOrFallback=function(){Modernizr.geolocation?google.maps.event.addListenerOnce(this.positionMarker,"position_changed",function(){this.map.setCenter(this.getPosition()),this.map.fitBounds(this.getBounds()),searchForEntries()}):this.moveToLocation(this.DEFAULT_LAT,this.DEFAULT_LONG)},Location.prototype.moveToLocation=function(o){this.map&&(this.map.panTo(o),searchForEntries())};var userLocation=new Location,mapOptions={center:userLocation.DEFAULT_LOCATION,zoom:17,mapTypeControl:!0,mapTypeId:google.maps.MapTypeId.SATELLITE,disableDefaultUI:!0,zoomControl:!0};